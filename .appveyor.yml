version: 1.3.{build}
skip_tags: true
image: Visual Studio 2022
configuration: Release
dotnet_csproj:
  patch: true
  file: '.msbuild\custom.targets'
  version: '{version}'
  file_version: '{version}'
  package_version: '{version}'
  informational_version: $(APPVEYOR_REPO_BRANCH):$(APPVEYOR_REPO_COMMIT)
build:
  publish_nuget: true
  publish_nuget_symbols: true
  use_snupkg_format: true
  verbosity: normal
before_test:
  - cmd: |
      set PATH=C:\Tools\NUnit3\bin;%APPVEYOR_BUILD_FOLDER%\packages\Machine.Specifications.Runner.Console.1.0.0\tools;%PATH%
      REM Remove Machine.Specifications VS Adapter dlls
      del %APPVEYOR_BUILD_FOLDER%\HermaFx.SimpleConfig.Tests\bin\Release\Machine.*
      del %APPVEYOR_BUILD_FOLDER%\HermaFx.SimpleConfig.Tests\bin\Release\Mono.*
      REM Remove Castle.Core.dll too, as to ensure no dependency against it exists (due to ilmergin)
      del %APPVEYOR_BUILD_FOLDER%\HermaFx.SimpleConfig.Tests\bin\Release\Castle.*
after_test:
  - ps: |
      #$wc = New-Object 'System.Net.WebClient'
      #$wc.UploadFile("https://ci.appveyor.com/api/testresults/nunit/$($env:APPVEYOR_JOB_ID)", (Resolve-Path .\TestResult.xml))
deploy:
  - provider: NuGet
    api_key:
      secure: Q4OXEbGW8LT+gQB7da8c1oK/MAwv+PD/t2Jne9gEdLRM2uVYIKjFwmpqjvUXKcM7
    on:
      branch: master
notifications:
  - provider: Email
    to:
      - '{{commitAuthorEmail}}'
    on_build_success: true
    on_build_failure: true
    on_build_status_changed: true

